package main

import (
	"bufio"
	"bytes"
	"errors"
	"fmt"
	"io"
	"net"
	"os"
	"strconv"
	"strings"
	"time"
)

const page_prog = `
'// ============================================================================
'//  Print in Page mode
'// ============================================================================

'// Initialize printer
    ESC "@"

'// Select Page mode
    ESC "L"
'// Set horizontal and vertical motion units: Horizontal motion unit = 0.125 mm
'// (1/203 inch), vertical motion unit = 0.125 mm (1/203 inch)
'// The above are values based on the dot density of the TM-T20 printing head,
'// and this script must be changed for each model.
    GS "P" 203 203


'// --- Store edge data --->>>
'// Set print area in Page mode: Horizontal logical origin = 6, vertical logical
'// origin = 0, horizontal dimension = 500, vertical dimension = 750
'// ESC  W  xL xH yL yH dxL dxH dyL dyH
    ESC "W"  6  0  0  0 244   1 238   2

'// [Concept of the above area size]
'//   (Premise) Use ESC * to print the sheet bordering by repeating 10 times on
'//      the short side and 15 times on the long side with the 25 dot (25 byte)
'//      column data as the unit pattern.
'//   1) If using ESC * with an 8-dot single-density, the dot density for each
'//      printing direction will be 203/2 [dpi] for both the short side (left-
'//      to-right printing) and long side (up-to-down printing) due to the ESC
'//      * command specifications in the TM-T20.
'//   2) Because the head of this script defines the horizontal and vertical
'//      motion units as 203 using GS P, due to 1), the size of 1 dot =
'//      horizontal and vertical motion units x 2 (for both short and long
'//      sides).
'//      Therefore, the size necessary to store the sheet bordering data is, in
'//      the horizontal and vertical motion units,
'//      short side: 25 dots*10 times*2 = 500, long side: 25 dots*15 times*2 = 750
'//  (Refer to the detailed specifications for the ESC W, ESC * , GS P commands.)

'// Select print direction in Page mode:
'// Starting position = upper left, print direction = left to right
    ESC "T" 0
'// Select bit-image mode: Write the column data for 8-dot single-density, 25
'// byte (border design pattern minimum unit)
'// Repeat this 10 times to construct a short side border pattern (coupon right
'// side)
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80

'// Select print direction in Page mode:
'// Starting position = lower left, print direction = bottom to top
    ESC "T" 1
'// Select bit-image mode: Same as above
'// Repeat 15 times in the same way to construct a long side border pattern (coupon
'// upper side)
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80


'// Select print direction in Page mode:
'// Starting position = lower right, print direction = right to left
    ESC "T" 2
'// Select bit-image mode: Same as above
'// Construct 1 more short side border pattern (coupon left side)
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80

'// Select print direction in Page mode:
'// Starting position = upper right, print direction = top to bottom
    ESC "T" 3
'// Select bit-image mode: Same as above
'// Construct 1 more long side border pattern (coupon lower side)
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
    ESC "*" 0 25 0
      0x80 0x80 0x80 0x60 0x80 0x80 0x80 0x8C 0xA5 0x51 0x4E 0x20 0x1A 0x20 0x4E
      0x51 0xA5 0x8C 0x80 0x80 0x80 0x60 0x80 0x80 0x80
'// --- Store the border data ---<<<


'// --- Store message data --->>>
'// Set print area in Page mode: Horizontal logical origin = 140, vertical logical
'// origin = 118, horizontal dimension = 360, vertical dimension = 528
'// ESC  W   xL xH  yL yH dxL dxH dyL dyH
    ESC "W" 140  0 118  0 104   1  16   2
'// Select print direction in Page mode:
'// Starting position = lower left, print direction = bottom to top
    ESC "T" 1

'// Select character size: (horizontal (times 2) x vertical (times 2))
    GS "!" 0x11
'// Print and line feed and print character string
    LF " Merry Christmas !!" LF LF

'// Select character size: (horizontal (times 2) x vertical (times 1))
    GS "!" 0x10
    "   10% OFF COUPON"

'// Print and feed paper: paper feeding amount = 25.0 mm (200/203 inches)
    ESC "J" 200

    "EPSON DEPARTMENT STORE"
'// --- Store message data ---<<<


'// --- Store symbol A data --->>>
'// Print settings for the symbol on the top left of the coupon (Christmas tree)

'// Set print area in Page mode: Horizontal logical origin = 50, vertical logical
'// origin = 588, horizontal dimension = 72, vertical dimension = 68
'// ESC  W  xL xH yL yH dxL dxH dyL dyH
    ESC "W" 50  0 76  2  72   0  68   0

'// [Concept of the above area size]
'//   1) The symbol to be printed is a 24 dot tall, 34 dot wide graphic.
'//      This was constructed by using ESC * to stack 3 layers of 34 dot (34 byte)
'//      column data, and is printed.
'//   2) The printing direction is assumed to be "down to up", the graphic's
'//      "side" is the direction that corresponds to the dy parameter in ESC W
'//      (paper feeding direction).
'//   3) If using ESC * with 8-dot single-density, considering the print direction
'//      in 2) is "down to up", the dot density for the "side" of the graphic is
'//      the dot density of "vertical" in ESC *, in other words, 203/2 [dpi].
'//   4) Because the head of this script defines the horizontal and vertical
'//      motion units as 203 using GS P, the width of the "side" of 1 dot in the
'//      graphic corresponds to the horizontal and vertical motion units*2.
'//      Therefore, the necessary dy size to store 34 dots is 34*2=68.
'//      (dyL=68, dyH=0)
'//   5) In the same way, the height of 1 graphic dot = horizontal and vertical
'//      motion units*3.
'//      Therefore, the necessary dx size to store 24 dots is 24*3=72.
'//  (Refer to the detailed specifications for the ESC W, ESC *, GS P commands.)

'// Select print direction in Page mode:
'// Starting position = lower left, print direction = bottom to top
    ESC "T" 1
'// Set line spacing: Line spacing for 8 dots (so that there is not excess space
'// between lines)
    ESC "3" 24

'// Select bit-image mode: 8-dot single-density, 34 byte column data
'// Construct 1 graphic symbol with 3 lines
'// Be aware that it is column data that lines up in the y direction of ESC W
'// because of ESC T settings.
    ESC "*" 0 34 0
      0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01 0x01 0x03 0x05 0x29 0x28 0x38 0x30
      0x20 0xE0 0x20 0x31 0x38 0x28 0x29 0x05 0x03 0x01 0x01 0x00 0x00 0x00 0x00
      0x00 0x00 0x00 0x00
    ESC "*"  0 34  0
      0x00 0x00 0x00 0x00 0x00 0x08 0x18 0x19 0x2A 0x4C 0x8C 0x80 0x02 0x47 0xE2
      0x40 0x00 0x80 0xC4 0x8E 0x04 0x80 0x8C 0x4C 0x2A 0x19 0x18 0x08 0x00 0x00
      0x00 0x00 0x00 0x00
    ESC "*"  0 34  0
      0x00 0x00 0x00 0x40 0x40 0xC0 0xC0 0x40 0x5C 0x54 0x57 0x55 0x55 0x75 0x75
      0x55 0x55 0x55 0x75 0x75 0x55 0x55 0x57 0x54 0x5C 0x40 0xC0 0xC0 0x40 0x40
      0x40 0x00 0x00 0x00
'// --- Store symbol A data ---<<<


'// --- Store symbol B data --->>>
'// Print settings for the symbol on the bottom right of the coupon
'// (Christmas cake)

'// Set print area in Page mode: Horizontal logical origin = 314, vertical logical
'// origin = 102, horizontal dimension = 72, vertical dimension = 96
'//    ESC  W  xL xH  yL yH dxL dxH dyL dyH
    ESC "W" 58  1 102  0  72   0  96   0
'// Select print direction in Page mode:
'// Starting position = lower left, print direction = bottom to top
    ESC "T" 1

'// Select bit-image mode: 8-dot single-density, 48 byte column data
    ESC "*" 0 48 0
      0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x07 0x07 0x09 0x09 0x7D 0x7C 0x10
      0x10 0x16 0x16 0x10 0x70 0xF8 0xFC 0x7E 0x3E 0x3E 0x7E 0xFE 0xFC 0x70 0x10
      0x16 0x16 0x10 0x10 0x7C 0x7D 0x09 0x09 0x07 0x07 0x00 0x00 0x00 0x00 0x00
      0x00 0x00 0x00
    ESC "*" 0 48  0
      0x1F 0x1F 0x24 0x21 0x40 0x42 0x42 0x41 0xF1 0xF1 0x29 0x59 0x59 0x8C 0x8C
      0xD4 0xD4 0xA4 0xA4 0xD4 0xD4 0x8C 0x8C 0xD4 0xD4 0xAC 0xAC 0xC4 0xC4 0xAC
      0xAC 0x94 0x94 0xAC 0xAC 0x49 0x49 0x29 0xF1 0xF1 0x41 0x42 0x42 0x40 0x23
      0x24 0x1F 0x1F
    ESC "*" 0 48  0
      0xF0 0xF0 0x4C 0x4C 0x24 0x24 0x24 0x12 0x12 0x12 0x12 0x12 0x12 0x89 0xA9
      0xA9 0x89 0x89 0x99 0x99 0x89 0x80 0x89 0xC9 0xC9 0x89 0x99 0x99 0x89 0xC9
      0xC9 0x89 0xA9 0xA9 0x89 0x12 0x12 0x12 0x12 0x12 0x12 0x24 0x24 0x24 0x4C
      0x4C 0xF0 0xF0
'// --- Store symbol B data ---<<<


'// --- Store the barcode --->>>
'// Set print area in Page mode: Horizontal logical origin = 276, vertical logical
'// origin = 226, horizontal dimension = 70, vertical dimension = 312
'//    ESC  W  xL xH  yL yH dxL dxH dyL dyH
    ESC "W" 20  1 226  0  70   0  56   1
'// Select print direction in Page mode:
'// Starting position = lower left, print direction = bottom to top
    ESC "T" 1
'// Select print position of HRI characters: Print position, below the barcode
    GS "H" 2
'// Select font for HRI characters: Font B
    GS "f" 1
'// Set barcode height: in case TM-T20, 5.00 mm (40/203 inches)
    GS "h" 40
'// Set barcode width: Module width = 2 (in case TM-T20, 0.250 mm)
    GS "w" 2
'// Set absolute vertical print position in Page mode: 5.00 mm (40/203 inches)
    GS "$" 40 0
'// Print barcode: (A) format, barcode system = CODE39
    GS "k" 4 "*10% OFF*" 0
'// --- Store the barcode ---<<<


'// Print data in Page mode: Batch print
    ESC FF
'// Select cut mode and cut paper: [Function B] Feed paper to (cutting position
'// + 10 mm (80/203 inches)) and executes a partial cut (one point left uncut).
    GS "V" 66 80
'// Select Standard mode (return to Standard mode)
    ESC "S"
`

const prog = `
'// ============================================================================
'// Issuing receipts with barcodes
'// ============================================================================

'// --- Initial setting --->>>
'// Initialize printer
    ESC "@"
'// Set horizontal tab positions: 35th column
    ESC "D" 35 0
'// Set horizontal and vertical motion units: Horizontal motion unit = 0.141 mm
'// (1/180 inch), vertical motion unit = 0.141 mm (1/180 inch)
    GS "P" 180 180

'// Set graphics data: [Function 83] Define the download graphics data
'// (raster format)
'// Define data that is 30*8 dots wide and 40 dots high with respect to key code
'// "A1"
'// GS ( L   pL  pH   m  fn  a  kc1/Kc2  b  xL  xH  yL  yH   c
    GS "(L" 187   4  48  83 48   "A1"    1 240   0  40   0  49
'//      1    2    3    4    5    6    7    8    9   10   11   12   13   14   15
'//     16   17   18   19   20   21   22   23   24   25   26   27   28   29   30
      0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF
      0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF
      0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF
      0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF
      0xC0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
      0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x03
      0xC0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
      0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x03
      0xC0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
      0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x03
      0xC0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
      0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x03
      0xC0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
      0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x03
      0xC0 0x18 0x00 0x60 0x1F 0xE0 0x18 0x00 0x61 0xFF 0xF0 0x00 0x03 0xFF 0xE0
      0x3F 0xFF 0xC0 0x3F 0xC0 0x3F 0xFF 0xC1 0xF0 0x7F 0xFC 0x07 0xFF 0xF8 0x03
      0xC0 0x18 0x00 0x60 0x3F 0xF0 0x18 0x00 0x61 0xFF 0xF8 0x00 0x03 0xFF 0xF0
      0x3F 0xFF 0xC0 0x7F 0xE0 0x3F 0xFF 0xC1 0xF0 0x7F 0xFE 0x07 0xFF 0xF8 0x03
      0xC0 0x0C 0x00 0xC0 0x70 0x38 0x18 0x00 0x61 0x80 0x1C 0x00 0x03 0x00 0x38
      0x30 0x00 0x00 0xE0 0x70 0x30 0x00 0x00 0xC0 0x60 0x07 0x00 0x0C 0x00 0x03

      0xC0 0x0C 0x00 0xC0 0x60 0x18 0x18 0x00 0x61 0x80 0x0E 0x00 0x03 0x00 0x1C
      0x30 0x00 0x00 0xC0 0x38 0x30 0x00 0x00 0xC0 0x60 0x03 0x80 0x0C 0x00 0x03
      0xC0 0x06 0x01 0x80 0xE0 0x1C 0x18 0x00 0x61 0x80 0x06 0x00 0x03 0x00 0x0C
      0x30 0x00 0x01 0xC0 0x18 0x30 0x00 0x00 0xC0 0x60 0x01 0x80 0x0C 0x00 0x03
      0xC0 0x06 0x01 0x80 0xC0 0x0C 0x18 0x00 0x61 0x80 0x06 0x00 0x03 0x00 0x0C
      0x30 0x00 0x01 0x80 0x0C 0x30 0x00 0x00 0xC0 0x60 0x01 0x80 0x0C 0x00 0x03
      0xC0 0x03 0x03 0x00 0xC0 0x0C 0x18 0x00 0x61 0x80 0x06 0x00 0x03 0x00 0x0C
      0x30 0x00 0x03 0x80 0x0C 0x30 0x00 0x00 0xC0 0x60 0x01 0x80 0x0C 0x00 0x03
      0xC0 0x03 0x03 0x01 0x80 0x06 0x18 0x00 0x61 0x80 0x06 0x00 0x03 0x00 0x0C
      0x30 0x00 0x03 0x00 0x00 0x30 0x00 0x00 0xC0 0x60 0x01 0x80 0x0C 0x00 0x03
      0xC0 0x01 0x86 0x01 0x80 0x06 0x18 0x00 0x61 0x80 0x06 0x00 0x03 0x00 0x0C
      0x30 0x00 0x03 0x00 0x00 0x30 0x00 0x00 0xC0 0x60 0x01 0x80 0x0C 0x00 0x03
      0xC0 0x01 0x86 0x01 0x80 0x06 0x18 0x00 0x61 0x80 0x0E 0x00 0x03 0x00 0x1C
      0x30 0x00 0x03 0x00 0x00 0x30 0x00 0x00 0xC0 0x60 0x03 0x80 0x0C 0x00 0x03
      0xC0 0x00 0xCC 0x01 0x80 0x06 0x18 0x00 0x61 0x80 0x1C 0x00 0x03 0x00 0x38
      0x30 0x00 0x03 0x00 0x00 0x30 0x00 0x00 0xC0 0x60 0x07 0x00 0x0C 0x00 0x03
      0xC0 0x00 0xCC 0x01 0x80 0x06 0x18 0x00 0x61 0xFF 0xF8 0x00 0x03 0xFF 0xF0
      0x30 0x00 0x03 0x00 0x00 0x30 0x00 0x00 0xC0 0x7F 0xFE 0x00 0x0C 0x00 0x03
      0xC0 0x00 0x78 0x01 0x80 0x06 0x18 0x00 0x61 0xFF 0xF0 0x00 0x03 0xFF 0xE0
      0x3F 0xFF 0x83 0x00 0x00 0x3F 0xFF 0x80 0xC0 0x7F 0xFC 0x00 0x0C 0x00 0x03

      0xC0 0x00 0x78 0x01 0x80 0x06 0x18 0x00 0x61 0x83 0x00 0x00 0x03 0x06 0x00
      0x3F 0xFF 0x83 0x00 0x00 0x3F 0xFF 0x80 0xC0 0x60 0x00 0x00 0x0C 0x00 0x03
      0xC0 0x00 0x30 0x01 0x80 0x06 0x18 0x00 0x61 0x81 0x80 0x00 0x03 0x03 0x00
      0x30 0x00 0x03 0x00 0x00 0x30 0x00 0x00 0xC0 0x60 0x00 0x00 0x0C 0x00 0x03
      0xC0 0x00 0x30 0x01 0x80 0x06 0x18 0x00 0x61 0x81 0x80 0x00 0x03 0x03 0x00
      0x30 0x00 0x03 0x00 0x00 0x30 0x00 0x00 0xC0 0x60 0x00 0x00 0x0C 0x00 0x03
      0xC0 0x00 0x30 0x01 0x80 0x06 0x18 0x00 0x61 0x80 0xC0 0x00 0x03 0x01 0x80
      0x30 0x00 0x03 0x00 0x00 0x30 0x00 0x00 0xC0 0x60 0x00 0x00 0x0C 0x00 0x03
      0xC0 0x00 0x30 0x01 0x80 0x06 0x18 0x00 0x61 0x80 0xC0 0x00 0x03 0x01 0x80
      0x30 0x00 0x03 0x00 0x00 0x30 0x00 0x00 0xC0 0x60 0x00 0x00 0x0C 0x00 0x03
      0xC0 0x00 0x30 0x01 0x80 0x06 0x18 0x00 0x61 0x80 0x60 0x00 0x03 0x00 0xC0
      0x30 0x00 0x03 0x00 0x00 0x30 0x00 0x00 0xC0 0x60 0x00 0x00 0x0C 0x00 0x03
      0xC0 0x00 0x30 0x00 0xC0 0x0C 0x18 0x00 0x61 0x80 0x60 0x00 0x03 0x00 0xC0
      0x30 0x00 0x01 0x80 0x0C 0x30 0x00 0x00 0xC0 0x60 0x00 0x00 0x0C 0x00 0x03
      0xC0 0x00 0x30 0x00 0xC0 0x0C 0x1C 0x00 0xE1 0x80 0x30 0x00 0x03 0x00 0x60
      0x30 0x00 0x01 0x80 0x0C 0x30 0x00 0x00 0xC0 0x60 0x00 0x00 0x0C 0x00 0x03
      0xC0 0x00 0x30 0x00 0xE0 0x1C 0x0C 0x00 0xC1 0x80 0x30 0x00 0x03 0x00 0x60
      0x30 0x00 0x01 0xC0 0x18 0x30 0x00 0x00 0xC0 0x60 0x00 0x00 0x0C 0x00 0x03
      0xC0 0x00 0x30 0x00 0x60 0x18 0x0E 0x01 0xC1 0x80 0x18 0x00 0x03 0x00 0x30
      0x30 0x00 0x00 0xC0 0x38 0x30 0x00 0x00 0xC0 0x60 0x00 0x00 0x0C 0x00 0x03

      0xC0 0x00 0x30 0x00 0x70 0x38 0x07 0x03 0x81 0x80 0x1C 0x00 0x03 0x00 0x38
      0x30 0x00 0x00 0xE0 0x70 0x30 0x00 0x00 0xC0 0x60 0x00 0x00 0x0C 0x00 0x03
      0xC0 0x00 0x30 0x00 0x3F 0xF0 0x03 0xFF 0x01 0x80 0x0E 0x00 0x03 0x00 0x1C
      0x3F 0xFF 0xC0 0x7F 0xE0 0x3F 0xFF 0xC1 0xF0 0x60 0x00 0x00 0x0C 0x00 0x03
      0xC0 0x00 0x30 0x00 0x1F 0xE0 0x01 0xFE 0x01 0x80 0x0E 0x00 0x03 0x00 0x1C
      0x3F 0xFF 0xC0 0x3F 0xC0 0x3F 0xFF 0xC1 0xF0 0x60 0x00 0x00 0x0C 0x00 0x03
      0xC0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
      0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x03
      0xC0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
      0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x03
      0xC0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
      0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x03
      0xC0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
      0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x03
      0xC0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
      0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x03
      0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF
      0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF
      0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF
      0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF

'// --- Initial setting ---<<<


'// --- Print stamp --->>>
'// Select justification: Centering
    ESC "a" 1

'// Set graphics data: [Function 85] Print the specified download graphics data
'// Print the download graphics that correspond to key code "A1" with same width
'// and double-height characters
'// GS ( L   pL  pH   m  fn Kc1/Kc2 x y
    GS "(L"   6   0  48  85  "A1"   1 2

'// Print and feed paper: Paper feeding amount = 1.13 mm (8/180 inches)
    ESC "J" 8
'// Text data and print and line feed
    "Thank you" LF
    "NOVEMBER 1, 2012 15:00"
'// Print and feed n lines: Feed the paper three lines
    ESC "d" 3
'// --- Print stamp ---<<<


'// --- Print details --->>>
'// Select justification: Left justification
    ESC "a" 0
'// Detail text data and horizontal tab, print and line feed
    "TM-Hxxx" HT "  6.00" LF
    "PS-xxx"  HT "  1.70" LF LF
'// Select character size: (horizontal (times 1) x vertical (times 2))
    GS "!" 0x01
'// Detail text data and horizontal tab, print and line feed
    "TOTAL" HT "  7.70" LF
'// Select character size: Normal size
    GS "!" 0x00
'// Detail text data and horizontal tab, print and line feed
    "------------------------------------------" LF
    "PAID"   HT " 10.00" LF
    "CHANGE" HT "  2.30"
'// Print and feed n lines: Feed the paper three lines
    ESC "d" 3
'// --- Print details ---<<<


'// --- Print barcode --->>>
'// Select justification: Centering
    ESC "a" 1
    "<< Bonus points : 14 >>"
'// Print and feed paper: Paper feeding amount = 4.94 mm (35/180 inches)
    ESC "J" 35
'// Set barcode height: in case TM-T20, 6.25 mm (50/203 inches)
    GS "h" 50
'// Select print position of HRI characters: Print position, below the barcode
    GS "H" 2
'// Select font for HRI characters: Font B
    GS "f" 1
'// Print barcode: (A) format, barcode system = CODE39
    GS "k" 4 "*00014*" 0
'// --- Print barcode ---<<<


'// Select cut mode and cut paper: [Function B] Feed paper to
'// (cutting position + 4.23 mm (30/203 inches)) and executes a partial cut
'// (one point left uncut).
    GS "V" 66 30
'// ============================================================================
'// Issuing receipts with barcodes
'// ============================================================================
`
const prog_graphics = ` 
'// ============================================================================
'//  Print graphics
'// ============================================================================

'// Initialize printer
    ESC "@"

'// Set graphics data: [Function 67] Define the NV graphics data (raster format)
'// 128(=8*16) dots wide and 120 dots tall with respect to key code "G1"
'// GS ( L   pL  pH   m  fn   a kc1/Kc2  b  xL  xH  yL  yH   c
    GS "(L" 139   7  48  67  48   "G1"   1 128   0 120   0  49
'//    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16
    0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF
    0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01

    0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x0C 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x3C 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x7C 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0xFE 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x81 0xFE 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x03 0xF8 0x00 0x00 0x00 0x01
    0x83 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x1F 0x87 0x80 0x00 0x00 0x01
    0x87 0xFD 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x3F 0x00 0x78 0x00 0x00 0x01
    0x87 0xF1 0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x3E 0x00 0x1F 0x00 0x00 0x01
    0x83 0xE7 0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x5C 0x00 0x0F 0xC0 0x00 0x01

    0x80 0x4F 0xC0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x4E 0x00 0x07 0xE0 0x00 0x01
    0x80 0x7F 0xE0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x4F 0x00 0x01 0xF0 0x00 0x01
    0x80 0x3F 0xF0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x87 0x80 0x01 0xF8 0x00 0x01
    0x80 0x3F 0xF0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x83 0x80 0x00 0xFC 0x00 0x01
    0x80 0x1F 0xC8 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x81 0xC0 0x00 0x7E 0x00 0x01
    0x80 0x1F 0x98 0x00 0x00 0x00 0x00 0x00 0x00 0x01 0x00 0xC0 0x00 0x3F 0x00 0x01
    0x80 0x0E 0x3C 0x00 0x00 0x00 0x00 0x00 0x00 0x01 0x00 0x60 0x00 0x3F 0x00 0x01
    0x80 0x0C 0xFC 0x00 0x00 0x00 0x00 0x00 0x00 0x01 0x00 0x10 0x00 0x1F 0x80 0x01
    0x80 0x05 0xFE 0x00 0x00 0x00 0x00 0x00 0x00 0x02 0x00 0x0C 0x00 0x1F 0x80 0x01
    0x80 0x07 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x02 0x00 0x03 0xFF 0xFF 0x80 0x01

    0x80 0x03 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x02 0x00 0x00 0x3F 0xFF 0x80 0x01
    0x80 0x03 0xFF 0x80 0x00 0x00 0x00 0x00 0x00 0x06 0x00 0x00 0x01 0xFF 0x80 0x01
    0x80 0x01 0xFF 0x80 0x00 0x00 0x00 0x00 0x00 0x07 0xFF 0x80 0x00 0x1F 0x80 0x01
    0x80 0x01 0xFF 0xC0 0x00 0x00 0x00 0x00 0x00 0x07 0x80 0x7F 0x00 0x01 0x00 0x01
    0x80 0x00 0xFF 0xE0 0x00 0x00 0x00 0x00 0x00 0x0F 0xC0 0x00 0xFF 0x01 0x00 0x01
    0x80 0x00 0xFF 0xE0 0x00 0x00 0x00 0x00 0x00 0x0F 0xE0 0x00 0x00 0xFA 0x00 0x01
    0x80 0x00 0x7F 0xF0 0x00 0x00 0x00 0x00 0x00 0x0F 0xF8 0x00 0x00 0x06 0x00 0x01
    0x80 0x00 0x7F 0xF8 0x00 0x00 0x00 0x00 0x00 0x1F 0xFF 0xC0 0x00 0x1C 0x00 0x01
    0x80 0x00 0x3F 0xF8 0x00 0x00 0x00 0x00 0x00 0x1F 0xFF 0xFF 0xFF 0xFC 0x00 0x01
    0x80 0x00 0x3F 0xFC 0x00 0x00 0x00 0x00 0x00 0x1F 0xFF 0xFF 0xFF 0xF8 0x00 0x01

    0x80 0x00 0x1F 0xFE 0x00 0x00 0x00 0x00 0x00 0x1F 0xFF 0xFF 0xFF 0xF8 0x00 0x01
    0x80 0x00 0x1F 0xFF 0x80 0x00 0x00 0x00 0x00 0x1F 0xFF 0xFF 0xFF 0xF0 0x00 0x01
    0x80 0x00 0x0F 0xFF 0xF0 0x00 0x00 0x00 0x00 0x1F 0xFF 0xFF 0xFF 0xE0 0x00 0x01
    0x80 0x00 0x0F 0xFF 0xFE 0x00 0x00 0x00 0x00 0x1F 0xFF 0xFF 0xFF 0xC0 0x00 0x01
    0x80 0x00 0x07 0xFF 0xFF 0x80 0x00 0x00 0x00 0x0F 0xFF 0xFF 0xFF 0x80 0x00 0x01
    0x80 0x00 0x03 0xFF 0xFF 0xE0 0x00 0x00 0x00 0x0F 0xFF 0xFF 0xFF 0x00 0x00 0x01
    0x80 0x00 0x03 0xFF 0xFF 0xF0 0x00 0x00 0x00 0x0F 0xFF 0xFF 0xFE 0x00 0x00 0x01
    0x80 0x00 0x07 0xFF 0xFF 0xFC 0x00 0x00 0x00 0x0F 0xFF 0xFF 0xFC 0x00 0x00 0x01
    0x80 0x00 0x07 0xFF 0xFF 0xFC 0x00 0x00 0x00 0x07 0xFF 0xFF 0xF8 0x00 0x00 0x01
    0x80 0x00 0x0F 0xFF 0xFF 0xFE 0x00 0x00 0x00 0x07 0xFF 0xFF 0xF0 0x00 0x00 0x01

    0x80 0x00 0x0F 0xFF 0xFF 0xFE 0x00 0x00 0x00 0x07 0xFF 0xFF 0xE0 0x00 0x00 0x01
    0x80 0x00 0x1F 0xFF 0xFF 0xFF 0x00 0x00 0x00 0x03 0xFF 0xFF 0xC0 0x00 0x00 0x01
    0x80 0x00 0x1F 0xFF 0xFF 0xFF 0x00 0x00 0x00 0x03 0xFF 0xFF 0x80 0x00 0x00 0x01
    0x80 0x00 0x1F 0xFF 0xFF 0xFE 0x80 0x00 0x00 0x03 0xFF 0xFF 0x00 0x00 0x00 0x01
    0x80 0x00 0x1F 0xFF 0xFF 0xFC 0x80 0x00 0x00 0x03 0xFF 0xFE 0x00 0x00 0x00 0x01
    0x80 0x00 0x1F 0xFF 0xFF 0xF8 0xC0 0x00 0x00 0x03 0xFF 0xFC 0x00 0x00 0x00 0x01
    0x80 0x00 0x1F 0xFF 0xFF 0xF1 0x40 0x00 0x00 0x03 0xFF 0xE0 0x00 0x00 0x00 0x01
    0x80 0x00 0x1F 0xFF 0xFF 0xE3 0x20 0x00 0x00 0x07 0x80 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x1F 0xFF 0xFF 0xC3 0x20 0x00 0x00 0x07 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x1F 0xFF 0xFF 0x02 0x10 0x00 0x00 0x0F 0x00 0x00 0x00 0x00 0x00 0x01

    0x80 0x00 0x1F 0xFF 0xFC 0x06 0x10 0x00 0x00 0x0E 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x1F 0xFF 0xE0 0x04 0x08 0x00 0x00 0x0E 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x0F 0xFF 0x00 0x0C 0x08 0x00 0x00 0x1C 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x08 0x00 0x00 0x1C 0x04 0x00 0x00 0x38 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x08 0x00 0x00 0x38 0x04 0x00 0x00 0x38 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x04 0x00 0x00 0xF0 0x02 0x00 0x00 0x70 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x04 0x00 0x01 0xE0 0x02 0x00 0x00 0xE0 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x04 0x00 0x07 0xC0 0x01 0x00 0x00 0xE0 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x02 0x00 0x1F 0x80 0x01 0x00 0x01 0xC0 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x02 0x00 0xFE 0x00 0x00 0x80 0x01 0xC0 0x00 0x00 0x00 0x00 0x00 0x01

    0x80 0x00 0x01 0x03 0xFC 0x00 0x00 0x80 0x03 0x80 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x01 0x0F 0xF0 0x00 0x00 0x58 0x03 0x80 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0xFF 0xC0 0x00 0x00 0x67 0x07 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0xFF 0x00 0x00 0x00 0x63 0xC7 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x7C 0x00 0x00 0x00 0x73 0xFE 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x78 0x00 0x00 0x00 0x73 0xFE 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x40 0x00 0x00 0x00 0x3B 0xFE 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x20 0x00 0x00 0x00 0x3B 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x20 0x00 0x00 0x00 0x1B 0xFF 0x80 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x20 0x00 0x00 0x00 0x1F 0xFF 0x80 0x00 0x00 0x00 0x00 0x00 0x01

    0x80 0x00 0x00 0x10 0x00 0x00 0x00 0x0F 0xFF 0xC0 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x10 0x00 0x00 0x00 0x0F 0xFF 0xE0 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x08 0x00 0x00 0x00 0x07 0xFF 0xE0 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x08 0x00 0x00 0x00 0x03 0xFF 0xE0 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x04 0x00 0x00 0x00 0x01 0xFF 0xC0 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x04 0x00 0x00 0x00 0x00 0x9C 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x02 0x00 0x00 0x00 0x00 0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x02 0x00 0x00 0x00 0x00 0x40 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x01 0x00 0x00 0x00 0x00 0x40 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x01 0x00 0x00 0x00 0x00 0x40 0x00 0x00 0x00 0x00 0x00 0x00 0x01

    0x80 0x00 0x00 0x00 0x80 0x00 0x00 0x00 0x20 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x80 0x00 0x00 0x00 0x20 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x40 0x00 0x00 0x00 0x70 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x40 0x00 0x00 0x00 0xE0 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x20 0x00 0x00 0x01 0xF8 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x20 0x00 0x00 0x03 0xF8 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x20 0x00 0x00 0x0F 0xFC 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x10 0x00 0x00 0x3F 0xFC 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x10 0x00 0x03 0xFF 0xFC 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x08 0x00 0x3F 0xFF 0xFC 0x00 0x00 0x00 0x00 0x00 0x00 0x01

    0x80 0x00 0x00 0x00 0x08 0x03 0xFF 0xFF 0xFC 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x04 0x3F 0xFF 0xFF 0xFC 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x07 0xFF 0xFF 0xFF 0xF8 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x03 0xFF 0xFF 0xFF 0xF8 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x03 0xFF 0xFF 0xFF 0xF0 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x01 0xFF 0xFF 0xFF 0xE0 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x01 0xFF 0xFF 0xFF 0xC0 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x00 0xFF 0xFF 0xFF 0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x00 0xFF 0xFF 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x00 0x7F 0xFF 0xFE 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01

    0x80 0x00 0x00 0x00 0x00 0x7F 0xFF 0xF8 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x00 0x3F 0xFF 0xE0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x00 0x1F 0xFF 0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x00 0x0F 0xFE 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x00 0x07 0xF0 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01
    0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF


'// Set graphics data: [Function 69] Print the specified NV graphics data.
'// Prints data that corresponds to key code "G1" at 1x1 size.
'// GS ( L   pL  pH   m  fn kc1/Kc2 x y
    GS "(L"   6   0  48  69  "G1"   1 1

'// Select cut mode and cut paper: [Function B] Feed paper to (cutting position +
'// 0 mm) and executes a partial cut (one point left uncut).
    GS "V" 66 0
`

// ref: https://reference.epson-biz.com/modules/ref_escpos/index.php?content_id=72
var lookup = map[string]byte{
	"EOT": 0x04, // End of Transmission
	"ENQ": 0x05, // Enquiry
	"HT":  0x09, // Horizontal Tab
	"DLE": 0x10, // Data Line Excape
	"LF":  0x0a, // Print and Line Feed
	"FF":  0x0C, // Print and return to Standard mode from Page mode.
	"CR":  0x0D, // Carriage Return
	"DC4": 0x14, // Device Control 4
	"CAN": 0x18, // Cancel print data
	"ESC": 0x1B, // Escape
	"FS":  0x1C, // File Separator
	"GS":  0x1D, // Group Separator
	"SP":  0x20, // Space ` `
}

func parse(reader io.Reader, out io.Writer) bool {
	in := bufio.NewReader(reader)

	for {
		line, err := in.ReadString(lookup["LF"])
		if err != nil {
			if errors.Is(err, io.EOF) {
				return false
			}
			fmt.Println("unexpected error:", err)
			return false
		}
		line = strings.TrimSpace(line)
		if len(line) <= 1 || strings.HasPrefix(line, "'//") {
			// Empty or comment. Skip.
			continue
		}

		parts := strings.Split(line, " ")
		inQuote := false
		for _, p := range parts {
			//fmt.Println("-->", p)

			if len(p) == 1 && p == "\"" {
				inQuote = true
				continue
			}
			if inQuote && (p == " " || p == "") {
				_, _ = out.Write([]byte(" "))
			}

			if p == "" || p == " " {
				continue
			}
			if inQuote && !strings.HasSuffix(p, "\"") {
				fmt.Printf("Mid-Quote: %s\n", p)
				_, _ = out.Write([]byte(p))
				_, _ = out.Write([]byte(" "))
			} else if code, ok := lookup[p]; ok {
				fmt.Printf("Code: %s, %x\n", p, code)
				_, _ = out.Write([]byte{code})
			} else if strings.HasPrefix(p, "\"") && strings.HasSuffix(p, "\"") {
				code := strings.TrimPrefix(p, "\"")
				code = strings.TrimSuffix(code, "\"")
				fmt.Printf("String: %s\n", code)
				_, _ = out.Write([]byte(code))
			} else if strings.HasPrefix(p, "\"") {
				inQuote = true
				code := strings.TrimPrefix(p, "\"")
				fmt.Printf("Start Quote: %s\n", code)
				_, _ = out.Write([]byte(code))
			} else if strings.HasSuffix(p, "\"") {
				inQuote = false
				code := strings.TrimSuffix(p, "\"")
				fmt.Printf("End Quote: %s\n", code)
				_, _ = out.Write([]byte(code))
			} else {
				// Number.
				code, err := strconv.ParseUint(p, 0, 8)
				if err != nil {
					fmt.Println("failed to parse number", p, err)
				}
				if strings.HasPrefix(p, "0x") {
					fmt.Printf("%08b", code)
				} else {
					fmt.Printf("Number %d\n", code)
				}
				_, _ = out.Write([]byte{byte(code)})
			}
		}
		fmt.Println("")
		//fmt.Println(line)
	}

	return false
}

func main() {
	//in := bytes.NewBuffer([]byte(label_prog))
	//in := bytes.NewBuffer([]byte(page_prog))
	in := bytes.NewBuffer([]byte(prog))
	//in := bytes.NewBuffer([]byte(prog_graphics))

	args := os.Args
	argLen := len(args)
	if argLen == 0 {
		fmt.Println("Error: expected host:port")
		os.Exit(1)
	}
	host := args[1]

	_, err := net.ResolveTCPAddr("tcp", host)
	if err != nil {
		fmt.Println("Error: resolve TCP address", host)
		os.Exit(1)
	}

	ipconn, err := net.DialTimeout("tcp", host, time.Second*5)
	if err != nil {
		panic(err)
	}
	conn := ipconn.(*net.TCPConn)

	//_, err = serverConn.Write([]byte("hello world\n"))
	//if err != nil {
	//	panic(err)
	//}

	if !parse(in, conn) {
		return
	}
}
